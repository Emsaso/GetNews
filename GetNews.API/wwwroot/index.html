<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title></title>
</head>

<body>
    <div id="app"></div>
    <script>
        const model = {
            email: 'a@b.com',
            code: '',
            message: '',
        };
        updateView();
        function updateView() {
            document.getElementById('app').innerHTML = `
                <input
                    type="text"
                    oninput="model.email=this.value"
                    value="${model.email}"
                    placeholder="E-postadresse"
                    /><br/>
                <input
                    type="text"
                    oninput="model.code=this.value"
                    value="${model.code}"
                    placeholder="Kode"
                    /><br/>
                <button onclick="subscribe()">Abonner på nyhetsbrev</button>
                <button onclick="verify()">Bekreft nyhetsbrev</button>
                <div style="color:orange;">${model.message ?? ''}</div>
            `;
        }

        async function subscribe() {
            // Lager brukeren i databasen (senere skal sende e-post med verifiseringskode) 
            const data = await callApi('post', { EmailAddress: model.email })
            // her skal vi sende e-post med verifiseringskode
            model.message = JSON.stringify(data);
            console.log(model)
            updateView();
        }
        async function verify() {
            // sjekker om koden er riktig (senere skal vi oppdatere databasen med verifisert=true)
            const data = await callApi('post', { EmailAddress: model.email, Token: model.code })
            // her skal vi oppdatere databasen med verifisert=true
            // bytt ut post med fetch eller get eller hva som er riktig

            console.log(model.code, data.VerificationCode);
            model.code == data.VerificationCode ? console.log("ja") : console.log("nei")
            updateView();
        }

        async function callApi(method, obj) {
            const response = await fetch('/api/subscription', {
                headers: {
                    'Content-type': 'application/json'
                },
                method,
                body: JSON.stringify(obj)
            });
            return response.json();
        }

    </script>
</body>

</html>